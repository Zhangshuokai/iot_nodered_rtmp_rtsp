# 准望物联监测平台项目架构设计文档

## 一、项目概述

准望物联监测平台是一个基于Next.js框架的开箱即用物联网平台，用于实现物联网数据收集、分析处理、可视化和设备管理。平台支持通过行业标准物联网协议（MQTT、TCP、UDP、CoAP和HTTP）实现设备连接，通过使用ws://或http://的流媒体实现摄像头视频流接入，帮助用户屏蔽物联网的复杂特性，专注于业务应用开发，缩短物联网项目的交付周期。

## 二、技术架构

### 1. 总体架构

准望物联监测平台采用基于Next.js的全栈架构，包含前端界面和后端API服务。系统整体采用以下技术栈：

- **前端**：React 18.x、TypeScript 5.x、TailwindCSS 3.x、Shadcn/UI、Zustand、React Query
- **后端**：Next.js API Routes、Node.js 18.x LTS、Prisma ORM
- **数据库**：PostgreSQL 15.x、TimescaleDB（时序数据库扩展）
- **通信协议**：MQTT、TCP/UDP、CoAP、HTTP/HTTPS、WebSocket
- **视频流处理**：使用ws://或http://的流媒体

### 2. 架构图

```
+------------------+        +------------------+        +------------------+
|                  |        |                  |        |                  |
|   客户端浏览器   | <----> |    Next.js应用   | <----> |   数据库服务     |
|                  |        |                  |        |                  |
+------------------+        +------------------+        +------------------+
                                    ^
                                    |
                                    v
+------------------+        +------------------+
|                  |        |                  |
|   物联网设备     | <----> |   物联网网关     |
|                  |        |                  |
+------------------+        +------------------+

+------------------+        +------------------+
|                  |        |                  |
|    摄像头        | <----> |  流媒体服务器    |
|                  |        |                  |
+------------------+        +------------------+
```

### 3. 子系统划分

平台分为七个主要子系统：

1. **设备接入子系统**：负责物联网设备的接入、认证、数据接收和指令下发
2. **视频流处理子系统**：负责摄像头视频流的接入、转换和分发
3. **数据存储与处理子系统**：负责设备数据的存储、处理和分析
4. **规则引擎子系统**：负责场景联动规则的执行和触发
5. **任务调度子系统**：负责任务的创建、调度和执行
6. **用户界面子系统**：负责用户交互界面的渲染和响应
7. **系统管理子系统**：负责平台配置、组织和权限管理

## 三、功能架构

### 1. 可视化大屏
- 大屏容器组件
- 可视化组件库（图表、状态指示、数据卡片、地图等）

### 2. 设备管理
- 设备类管理（设备类列表、详情/编辑）
- 设备管理（设备列表、详情、编辑）

### 3. 规则引擎
- 场景联动（列表、详情/编辑、触发器编辑）

### 4. 任务中心
- 任务管理（列表、详情、编辑）

### 5. 报表中心
- 报表配置（列表、编辑）
- 报表导出（列表、详情）

### 6. 视频中心
- 视频配置（展示、列表、编辑）

### 7. 系统管理
- 平台定制（公司信息配置）
- 组织管理（列表、详情、编辑）

## 四、数据流设计

### 1. 设备数据流
1. 设备通过MQTT、TCP、UDP、CoAP或HTTP协议连接到平台
2. 设备数据上报到平台后，存储到TimescaleDB时序数据库
3. 数据可被用于实时展示、触发规则、生成报表、作为任务执行依据

### 2. 视频数据流
1. 摄像头通过使用ws://或http://的流媒体协议接入平台
2. 视频流数据实时展示在视频中心

### 3. 命令控制流
1. 用户通过平台界面下发命令
2. 命令通过平台传递给目标设备
3. 设备执行命令并返回结果
4. 结果记录在设备管理的命令下发记录中

## 五、安全设计

### 1. 身份认证与授权
- 基于JWT的身份验证
- 基于角色的权限控制（RBAC）
- API访问频率限制

### 2. 数据安全
- 数据传输加密（HTTPS/TLS）
- 敏感数据加密存储
- 数据访问控制

### 3. 防攻击措施
- SQL注入防护：使用Prisma ORM进行参数化查询
- XSS攻击防护：React自动转义、内容安全策略(CSP)
- CSRF攻击防护：使用CSRF令牌
- DDoS防护：API请求限流
- 输入验证：前后端双重验证

### 4. 设备安全
- 设备认证机制
- 设备通信加密
- 设备权限管理

## 六、部署架构

### 1. 开发环境
- Node.js和npm环境
- 本地开发服务器
- 本地数据库服务

### 2. 生产环境
- 服务器部署（物理服务器或虚拟机）
- Nginx作为前端代理和负载均衡
- PostgreSQL数据库服务器
- 日志收集和监控系统

### 3. 扩展性考虑
- 模块化架构设计
- 数据存储优化
- 基于服务器的垂直扩展

## 七、技术选型理由

1. **Next.js**：提供前后端一体化开发，减少代码分离带来的复杂性
2. **React**：组件化开发，提高代码复用性和可维护性
3. **TypeScript**：提供静态类型检查，减少运行时错误
4. **TailwindCSS**：高度可定制，避免CSS冗余，提高开发效率
5. **Prisma**：类型安全的数据库访问，自动生成类型定义
6. **PostgreSQL/TimescaleDB**：强大的关系型数据库，支持时序数据存储

## 八、总结

准望物联监测平台采用现代化的全栈技术架构，通过模块化设计和标准化接口，实现了物联网设备的便捷接入和管理。平台具有良好的安全性、可扩展性和易用性，能够满足各类物联网应用场景的需求。 